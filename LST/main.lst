C51 COMPILER V9.57.0.0   MAIN                                                              05/05/2018 22:03:08 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\EXE\main.obj
COMPILER INVOKED BY: G:\Program Files\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\LST\main.lst) TABS(2) OBJECT(.\EXE\main.obj)

line level    source

   1          #include <REG51.H>
   2          
   3          xdata unsigned char PTWY _at_ 0x8008;
   4          
   5          // PWM_Pin
   6          sbit PWM_Pin = 0x96;
   7          
   8          // Deklaracje
   9          void Init(void);
  10          
  11          // Zmienne PWM
  12          unsigned char PWM = 0;    //  0 (0%) - 255 (100%)
  13          unsigned int temp = 0;    // Dla przerwania
  14          
  15          int PWMfreq = 1;  // Czestotliwosc
  16          
  17          // LCD
  18          xdata unsigned char CTRLW _at_ 0x8010;
  19          xdata unsigned char DATW _at_ 0x8011;
  20          xdata unsigned char CTRLR _at_ 0x8012;
  21          xdata unsigned char DATR _at_ 0x8013;
  22          
  23          
  24          // ADC
  25          xdata unsigned char PTAC0 _at_ 0x8005;
  26          unsigned char POT0(void);
  27          
  28          
  29          unsigned int cycles = 0;
  30          unsigned int cyfra = 0;
  31           unsigned int b;
  32           int h = 0;
  33          void BUSYLCD(void)
  34          {
  35   1       while (CTRLR&0x80);
  36   1      }
  37          
  38          void main (void)
  39          {
  40   1      
  41   1        Init();              // Inicjalizacja         
  42   1        
  43   1       PTWY = 0x01; 
  44   1      
  45   1        // LCD INIT 
  46   1        
  47   1      
  48   1       for(b=0;b<15000;b++);
  49   1       CTRLW=0x38;
  50   1       for(b=0;b<4200;b++);
  51   1       CTRLW=0x38;
  52   1       for(b=0;b<120;b++);
  53   1       CTRLW=0x38;
  54   1       BUSYLCD();
C51 COMPILER V9.57.0.0   MAIN                                                              05/05/2018 22:03:08 PAGE 2   

  55   1       CTRLW=0x38;
  56   1       BUSYLCD();
  57   1       CTRLW=0x0c;
  58   1       BUSYLCD();
  59   1       CTRLW=0x02;
  60   1       CTRLW=0x01;
  61   1       BUSYLCD();
  62   1       CTRLW=0x06;
  63   1       BUSYLCD();
  64   1       CTRLW=0x80;
  65   1       BUSYLCD();
  66   1      
  67   1      
  68   1       
  69   1       while(1)
  70   1       {
  71   2        PWMfreq = 250;
  72   2        
  73   2        b=POT0();
  74   2        PWM = b; 
  75   2        DATW = 'P';
  76   2        BUSYLCD();
  77   2        DATW = 'O';
  78   2        BUSYLCD();
  79   2        DATW = 'T';
  80   2        BUSYLCD();
  81   2        DATW = '0';
  82   2        BUSYLCD();
  83   2        DATW = ' ';
  84   2        BUSYLCD();
  85   2        DATW=b/100+'0';
  86   2        BUSYLCD();
  87   2        b=b%100;
  88   2        DATW=b/10+'0';
  89   2        BUSYLCD();
  90   2        DATW=b%10+'0';
  91   2        BUSYLCD();
  92   2        CTRLW=0x80; 
  93   2        BUSYLCD();
  94   2        
  95   2        
  96   2        DATW = 'P';
  97   2        BUSYLCD();
  98   2        DATW = 'W';
  99   2        BUSYLCD();
 100   2        DATW = 'M';
 101   2        BUSYLCD();
 102   2        DATW = ' ';
 103   2        BUSYLCD();
 104   2        DATW = 'f';
 105   2        BUSYLCD();
 106   2        DATW = ' ';
 107   2        BUSYLCD();
 108   2        DATW=PWMfreq/100+'0';
 109   2        BUSYLCD();
 110   2        PWMfreq=PWMfreq%100;
 111   2        DATW=PWMfreq/10+'0';
 112   2        BUSYLCD();
 113   2        DATW=PWMfreq%10+'0';
 114   2        BUSYLCD();
 115   2        CTRLW=0xC0; 
 116   2        BUSYLCD();
C51 COMPILER V9.57.0.0   MAIN                                                              05/05/2018 22:03:08 PAGE 3   

 117   2        
 118   2        
 119   2       
 120   2        
 121   2       }
 122   1      }
 123          
 124          
 125          // Timer0 init
 126          void InitTimers(void)
 127          {
 128   1      TMOD = 0x11;    // Zalaczanie przerwania 1 i 2
 129   1      TCON = 0x50;
 130   1      TH0 = 0x00;      // First time value
 131   1      TL0 = 0x00;      
 132   1      ET0 = 1;         // Enable przerwan
 133   1      EA  = 1;        
 134   1      TR0 = 1;         // Start Timera 0
 135   1      }
 136          
 137          
 138          // Odczyt z ADCka POT0
 139          unsigned char POT0(void)
 140          {
 141   1       unsigned char a=0;
 142   1       PTAC0=0;
 143   1       for(a=0;a<120;a++);
 144   1       return PTAC0;
 145   1      }
 146          
 147          
 148          
 149          // Init PWM & Timerów
 150          void Init(void)
 151          {
 152   1      PWM = 0;         // Wypelnienie 0
 153   1      InitTimers();    // Uruchom timer przerwan
 154   1      
 155   1      }
 156          
 157          // Timer0
 158          void Timer0 (void) interrupt 1  
 159          {
 160   1      TR0 = 0;    // Stop Timer 0
 161   1       
 162   1      TH0 = (unsigned char)(-5000 >> 8);
 163   1      TL0 = (unsigned char)(-5000 & 0x00ff);
 164   1        
 165   1      if(PWM_Pin) // Na stan wysoki
 166   1      {
 167   2      PWM_Pin = 0;
 168   2      temp = (255-PWM)*PWMfreq;
 169   2      TH0  = 0xFF - (temp>>8)&0xFF;
 170   2      TL0  = 0xFF - temp&0xFF;
 171   2      }
 172   1      else       // Na stan niski
 173   1      {
 174   2      PWM_Pin = 1;
 175   2      temp = PWM*PWMfreq;
 176   2      TH0  = 0xFF - (temp>>8)&0xFF;
 177   2      TL0  = 0xFF - temp&0xFF;
 178   2      }
C51 COMPILER V9.57.0.0   MAIN                                                              05/05/2018 22:03:08 PAGE 4   

 179   1       
 180   1      TF0 = 0;     // Czyszczenie flagi przerwania
 181   1      TR0 = 1;     // Start Timera
 182   1      }
 183          
 184          
 185          // Timer1
 186          void Timer1 (void) interrupt 3  
 187          {
 188   1      TR1 = 0;    // Stop Timer 0
 189   1       
 190   1      TH1 = (unsigned char)(-5000 >> 8);
 191   1      TL1 = (unsigned char)(-5000 & 0x00ff);
 192   1        
 193   1      
 194   1       
 195   1      TF1 = 0;     // Czyszczenie flagi przerwania
 196   1      TR1 = 1;     // Start Timera
 197   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    539    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
